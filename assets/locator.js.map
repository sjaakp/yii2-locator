{"version":3,"file":"locator.js","sources":["../src/touchdrag.js","../src/dotmarker.js","../src/spritemarker.js","../src/find.js","../src/index.js"],"sourcesContent":["/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n// https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\r\n// https://github.com/elmarquis/Leaflet.GestureHandling\r\n\r\nL.TouchDragHandler = L.Handler.extend({\r\n    addHooks: function() {\r\n        this._map.dragging.disable();\r\n        if (this._map.tap) {\r\n            this._map.tap.disable();\r\n        }\r\n        this._map._container.addEventListener('touchstart', this._handleTouch);\r\n        this._map._container.addEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.on(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    removeHooks: function() {\r\n        this._map.dragging.enable();\r\n        if (this._map.tap) {\r\n            this._map.tap.enable();\r\n        }\r\n        this._map._container.removeEventListener('touchstart', this._handleTouch);\r\n        this._map._container.removeEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.off(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    _handleTouch: function(e) {\r\n        if (e.type === 'touchstart' && e.touches.length === 1)  {\r\n            L.DomUtil.addClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.disable();\r\n        } else {\r\n            L.DomUtil.removeClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.enable();\r\n        }\r\n        return true;\r\n    },\r\n});\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.DotMarker = L.CircleMarker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the DotMarker:\r\n     * - 'className': HTML class of underlying SVG <path>. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#path\r\n     */\r\n    initialize: function(latlng, options) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        L.CircleMarker.prototype.initialize.call(this, latlng, Object.assign(options, {\r\n            radius: 8,\r\n            weight: 2,\r\n            fillOpacity: 1.0,\r\n            className: cl + 'dot-marker'\r\n        }));\r\n    }\r\n});\r\n\r\nL.dotMarker = function(latlng, options) {\r\n    return new L.DotMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.SpriteMarker = L.Marker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the SpriteMarker:\r\n     * - 'html': content of SpriteMarker; default empty. @link https://leafletjs.com/reference-1.6.0.html#divicon\r\n     * - 'className': HTML class of DIV. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#divicon-classname\r\n     * Use this to display FontAwesome markers like so: 'className': 'far fa-2x fa-dog'; leave 'html' unset.\r\n     */\r\n    initialize: function(latlng, options) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        options.icon = L.divIcon({\r\n            html: options.html || false,\r\n            iconSize: options.iconSize || 24,\r\n            bgPos: options.bgPos || null,\r\n            className: cl + 'sprite-marker'\r\n        });\r\n        L.Marker.prototype.initialize.call(this, latlng, options);\r\n    },\r\n});\r\n\r\nL.spriteMarker = function(latlng, options) {\r\n    return new L.SpriteMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.Map.include({\r\n\r\n    find: function(address) {\r\n        return this.findNominatim(address);\r\n    },\r\n\r\n    findNominatim: function(address) {\r\n        const server = '//nominatim.openstreetmap.org/search';\r\n        let map = this,\r\n            req1 = new XMLHttpRequest();\r\n        req1.addEventListener('load', function() {\r\n            let resp = JSON.parse(this.response);\r\n            if (resp.length > 0) {\r\n                let found = resp[0],\r\n                    latlng = L.latLng(found.lat, found.lon);\r\n                map.placeMarker(latlng);\r\n            }\r\n            else    {\r\n                map.fire('notfound');\r\n            }\r\n        });\r\n        req1.open('GET', server + '?format=json&q=' + encodeURIComponent(address));\r\n        req1.send();\r\n        return this;\r\n    }\r\n});\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n/*\r\n    Plugin for Leaflet\r\n    Tested with Leaflet 1.6.0\r\n    21-05-2018 ... 29-12-2019\r\n\r\n    Map has extra options:\r\n        marker      Plain object, options used for creating markers\r\n                        the option 'type' determines the type of marker (Marker, CircleMarker, DotMarker, SpriteMarker)\r\n                        the option 'icon' is a plain object with options to create the icon for a regular Marker (i.e. not the icon itself)\r\n        viewUrl     String, url jumped to when marker is clicked. If not set, no jump is performed.\r\n                        '{xxx}' gets replaced by Marker option <xxx>\r\n                        typical use: viewUrl = '/view/{id}'\r\n        cluster     Boolean. Whether MarkerClusterer is used.\r\n        touchdrag   Boolean. If true, map can only be panned with two fingers; warning overlay appears if attempted with one finger.\r\n                        Intended to avoid conflict with page scrolling on small devices.\r\n        scale       null: no scale | 1: metric scale | 2: imperial scale | 3: both.\r\n\r\n    Map always has a scale control with a metric scale\r\n\r\n    Two new classes:\r\n\r\n    DotMarker is an extension of CircleMarker. It gets the HTML class 'dot-marker'.\r\n\r\n    SpriteMarker is a Marker with a DivIcon. It has all the options of DivIcon. It gets the HTML class 'sprite-marker'.\r\n        Typical use: set the 'html' option to a SVG-element, either with an explicit path or a use class; use the option 'className' to colorize the sprite\r\n\r\n    Marker, CircleMarker, DotMarker, SpriteMarker each have extra options\r\n        monitor     String, the id of a HTML text input updated at moveend\r\n        title       HTML of tooltip\r\n */\r\n\r\nimport './touchdrag.js';\r\nimport './dotmarker.js';\r\nimport './spritemarker.js';\r\nimport './find.js';\r\n\r\nL.Map.addInitHook(function() {\r\n    if (this.options.scale !== null) {\r\n        let s = this.options.scale,\r\n            metric = s & 1,\r\n            imperial = s & 2;\r\n        this.addControl(L.control.scale({ metric: metric, imperial: imperial }));    // add scale control\r\n    }\r\n    if (this.options.touchdrag) this.addHandler('touchdrag', L.TouchDragHandler);       // and touchdrag handler\r\n});\r\n\r\n\r\nL.Map.include({\r\n\r\n    _geo: null,\r\n    _armed: false,      // true if click on map produces a marker\r\n\r\n    arm: function(markerOpts) {       // prepare for marker on click\r\n        if (! this._armed)  {\r\n            L.DomUtil.addClass(this.getContainer(), 'locator-armed');\r\n            this.options.marker = markerOpts;\r\n            this.on('click', function(e) {\r\n                this.disarm();\r\n                return this.addMarker(e.latlng, markerOpts);\r\n            });\r\n            this._armed = true;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    disarm: function() {\r\n        if (this._armed)    {\r\n            L.DomUtil.removeClass(this.getContainer(), 'locator-armed');\r\n            this.off('click');\r\n            this._armed = false;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    getGeo: function()  {\r\n        if (! this._geo)    {\r\n            let geo = L.geoJSON(null, {\r\n                    pointToLayer: function(ft, latlng) {\r\n                        let r = this.newMarker(latlng, Object.assign({}, this.options.marker, ft.properties)),\r\n                            title = ft.properties.title;\r\n                        if (title) r.bindTooltip(title);\r\n                        return r;\r\n                    }.bind(this),\r\n                }),\r\n                clusters = geo;\r\n            if (this.options.cluster)   {\r\n                clusters = L.markerClusterGroup();\r\n                clusters.addLayer(geo);\r\n            }\r\n            this.addLayer(clusters);\r\n            this._geo = geo;\r\n        }\r\n        return this._geo;\r\n    },\r\n\r\n    addFeature: function(feature)   {\r\n        this.getGeo().addData(feature);\r\n        return this;\r\n    },\r\n\r\n    monitorZoom: function(id) {\r\n        return this.on('zoomend', function(e) {\r\n            document.getElementById(id).value = e.target.getZoom();\r\n        }).fire('zoomend');\r\n    },\r\n\r\n    monitorCenter: function(id) {\r\n        return this.on('moveend', function(e) {\r\n            const c = e.target.getCenter();\r\n            document.getElementById(id).value = JSON.stringify({\r\n                type: 'Point',\r\n                coordinates: [c.lng, c.lat]\r\n            });\r\n        }).fire('moveend');\r\n    },\r\n\r\n    newMarker: function(latlng, options) {      // create a new marker of any type\r\n        let type = options.type || 'Marker';\r\n        if (type === 'Marker' && options.icon)  {\r\n            options.icon = L.icon(options.icon);\r\n        }\r\n        let r = new L[type](latlng, options).on('moveend', function(e) {\r\n            let id = e.target.options.monitor;\r\n            if (id) {\r\n                document.getElementById(id).value = JSON.stringify(e.target.toGeoJSON());\r\n            }\r\n        }).on('click', function (e)    {\r\n            let url = this._map.options.viewUrl;\r\n            if (url)  {\r\n                let matches = url.match(/{\\w+}/g);\r\n                if (matches)    {\r\n                    matches.forEach(function(match) {\r\n                        url = url.replace(match, this.options[match.slice(1, -1)]);\r\n                    }, this);\r\n                }\r\n                window.location = url;\r\n            }\r\n        });\r\n        if (options.title)  {\r\n            r.bindTooltip(options.title);\r\n        }\r\n        return r;\r\n    },\r\n\r\n    addMarker: function(latlng, markerOpts)  {\r\n        let m = this.newMarker(latlng, markerOpts);\r\n        this.addLayer(m);\r\n        this._marker = m;\r\n        m.fire('moveend');\r\n        return this;\r\n    },\r\n\r\n    placeMarker: function(latlng)   {\r\n        if (this._marker)    {\r\n            this._marker.setLatLng(latlng);\r\n        }\r\n        else {\r\n            this.unarm().addMarker(latlng, this.options.marker);\r\n        }\r\n        this.panTo(latlng);\r\n    },\r\n});\r\n"],"names":["L","TouchDragHandler","Handler","extend","addHooks","this","_map","dragging","disable","tap","_container","addEventListener","_handleTouch","DomEvent","on","removeHooks","enable","removeEventListener","off","e","type","touches","length","DomUtil","addClass","target","removeClass","DotMarker","CircleMarker","initialize","latlng","options","let","cl","className","prototype","call","Object","assign","radius","weight","fillOpacity","dotMarker","SpriteMarker","Marker","icon","divIcon","html","iconSize","bgPos","spriteMarker","Map","include","find","address","findNominatim","const","map","req1","XMLHttpRequest","resp","JSON","parse","response","found","latLng","lat","lon","placeMarker","fire","open","server","encodeURIComponent","send","addInitHook","scale","s","metric","imperial","addControl","control","touchdrag","addHandler","_geo","_armed","arm","markerOpts","getContainer","marker","disarm","addMarker","getGeo","geo","geoJSON","pointToLayer","ft","r","newMarker","properties","title","bindTooltip","bind","clusters","cluster","markerClusterGroup","addLayer","addFeature","feature","addData","monitorZoom","id","document","getElementById","value","getZoom","monitorCenter","c","getCenter","stringify","coordinates","lng","monitor","toGeoJSON","url","viewUrl","matches","match","forEach","replace","slice","window","location","m","_marker","setLatLng","unarm","panTo"],"mappings":"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"}
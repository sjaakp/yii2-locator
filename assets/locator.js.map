{"version":3,"file":"locator.js","sources":["../src/touchdrag.js","../src/dotmarker.js","../src/spritemarker.js","../src/find.js","../src/index.js"],"sourcesContent":["/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n// https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\r\n// https://github.com/elmarquis/Leaflet.GestureHandling\r\n\r\nL.TouchDragHandler = L.Handler.extend({\r\n    addHooks: function() {\r\n        this._map.dragging.disable();\r\n        if (this._map.tap) {\r\n            this._map.tap.disable();\r\n        }\r\n        this._map._container.addEventListener('touchstart', this._handleTouch);\r\n        this._map._container.addEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.on(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    removeHooks: function() {\r\n        this._map.dragging.enable();\r\n        if (this._map.tap) {\r\n            this._map.tap.enable();\r\n        }\r\n        this._map._container.removeEventListener('touchstart', this._handleTouch);\r\n        this._map._container.removeEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.off(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    _handleTouch: function(e) {\r\n        if (e.type === 'touchstart' && e.touches.length === 1)  {\r\n            L.DomUtil.addClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.disable();\r\n        } else {\r\n            L.DomUtil.removeClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.enable();\r\n        }\r\n        return true;\r\n    },\r\n});\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.DotMarker = L.CircleMarker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the DotMarker:\r\n     * - 'className': HTML class of underlying SVG <path>. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#path\r\n     */\r\n    initialize: function(latlng, options) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        L.CircleMarker.prototype.initialize.call(this, latlng, Object.assign(options, {\r\n            radius: 8,\r\n            weight: 2,\r\n            fillOpacity: 1.0,\r\n            className: cl + 'dot-marker'\r\n        }));\r\n    }\r\n});\r\n\r\nL.dotMarker = function(latlng, options) {\r\n    return new L.DotMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.SpriteMarker = L.Marker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the SpriteMarker:\r\n     * - 'html': content of SpriteMarker; default empty. @link https://leafletjs.com/reference-1.6.0.html#divicon\r\n     * - 'className': HTML class of DIV. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#divicon-classname\r\n     * Use this to display FontAwesome markers like so: 'className': 'far fa-2x fa-dog'; leave 'html' unset.\r\n     */\r\n    initialize: function(latlng, options) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        options.icon = L.divIcon({\r\n            html: options.html || false,\r\n            iconSize: options.iconSize || 24,\r\n            bgPos: options.bgPos || null,\r\n            className: cl + 'sprite-marker'\r\n        });\r\n        L.Marker.prototype.initialize.call(this, latlng, options);\r\n    },\r\n});\r\n\r\nL.spriteMarker = function(latlng, options) {\r\n    return new L.SpriteMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.Map.include({\r\n\r\n    find: function(address) {\r\n        const server = '//nominatim.openstreetmap.org/search';\r\n        let map = this,\r\n            req1 = new XMLHttpRequest();\r\n        req1.addEventListener('load', function() {\r\n            let resp = JSON.parse(this.response);\r\n            if (resp.length > 0) {\r\n                let found = resp[0],\r\n                    latlng = L.latLng(found.lat, found.lon);\r\n                map.placeMarker(latlng);\r\n            }\r\n            else    {\r\n                map.fire('notfound');\r\n            }\r\n        });\r\n        req1.open('GET', server + '?format=json&q=' + encodeURIComponent(address));\r\n        req1.send();\r\n        return this;\r\n    }\r\n});\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n/*\r\n    Plugin for Leaflet\r\n    Tested with Leaflet 1.6.0\r\n    21-05-2018 ... 29-12-2019\r\n\r\n    Map has extra options:\r\n        marker      Plain object, options used for creating markers\r\n                        the option 'type' determines the type of marker (Marker, CircleMarker, DotMarker, SpriteMarker)\r\n                        the option 'icon' is a plain object with options to create the icon for a regular Marker (i.e. not the icon itself)\r\n        urlTemplate     String, url jumped to or used to get popup contents when marker is clicked. If not set, no jump is performed.\r\n                        '{xxx}' gets replaced by Marker option <xxx>\r\n                        typical use: urlTemplate = '/view/{id}'\r\n        cluster     null|object. MarkerClusterer options; null: no clusters.\r\n        popup       null|object. Popup options; null: no popups.\r\n        touchdrag   Boolean. If true, map can only be panned with two fingers; warning overlay appears if attempted with one finger.\r\n                        Intended to avoid conflict with page scrolling on small devices.\r\n        scale       null: no scale | 1: metric scale | 2: imperial scale | 3: both.\r\n\r\n    Two new classes:\r\n\r\n    DotMarker is an extension of CircleMarker. It gets the HTML class 'dot-marker'.\r\n\r\n    SpriteMarker is a Marker with a DivIcon. It has all the options of DivIcon. It gets the HTML class 'sprite-marker'.\r\n        Typical use: set the 'html' option to a SVG-element, either with an explicit path or a use class; use the option 'className' to colorize the sprite\r\n\r\n    Marker, CircleMarker, DotMarker, SpriteMarker each have extra options\r\n        monitor     String, the id of a HTML text input updated at moveend\r\n        title       HTML of tooltip\r\n\r\n    @link https://leafletjs.com/\r\n    @link http://www.liedman.net/tiled-maps/ - The Hitchhackerâ€™s Guide To Tiled Maps\r\n */\r\n\r\nimport './touchdrag.js';\r\nimport './dotmarker.js';\r\nimport './spritemarker.js';\r\nimport './find.js';\r\n\r\nL.Map.addInitHook(function() {\r\n    if (this.options.scale !== null) {\r\n        let s = this.options.scale,\r\n            metric = s & 1,\r\n            imperial = s & 2;\r\n        this.addControl(L.control.scale({ metric: metric, imperial: imperial }));    // add scale control\r\n    }\r\n    if (this.options.touchdrag) this.addHandler('touchdrag', L.TouchDragHandler);       // and touchdrag handler\r\n});\r\n\r\n\r\nL.Map.include({\r\n\r\n    _markers: null,\r\n    _armed: false,      // true if click on map produces a marker\r\n\r\n    getMarkers: function()  {\r\n        if (! this._markers)    {\r\n            if (this.options.cluster !== null)  {\r\n                this._markers = L.markerClusterGroup(this.options.cluster);\r\n                this.addLayer(this._markers);\r\n            }\r\n            else this._markers = this;\r\n        }\r\n        return this._markers;\r\n    },\r\n\r\n    arm: function(markerOpts) {       // prepare for marker on click\r\n        if (! this._armed)  {\r\n            L.DomUtil.addClass(this.getContainer(), 'locator-armed');\r\n            this.options.marker = markerOpts;\r\n            this.on('click', function(e) {\r\n                this.disarm();\r\n                return this.addMarker(e.latlng, markerOpts);\r\n            });\r\n            this._armed = true;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    disarm: function() {\r\n        if (this._armed)    {\r\n            L.DomUtil.removeClass(this.getContainer(), 'locator-armed');\r\n            this.off('click');\r\n            this._armed = false;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    addFeature: function(feature)   {\r\n        this.getMarkers().addLayer(L.geoJSON(feature, {\r\n            pointToLayer: function (ft, latlng) {\r\n                return this.newMarker(latlng, Object.assign({}, this.options.marker, ft.properties));\r\n            }.bind(this),\r\n        }));\r\n        return this;\r\n    },\r\n\r\n    monitorZoom: function(id) {\r\n        return this.on('zoomend', function(e) {\r\n            document.getElementById(id).value = e.target.getZoom();\r\n        }).fire('zoomend');\r\n    },\r\n\r\n    monitorCenter: function(id) {\r\n        return this.on('moveend', function(e) {\r\n            const c = e.target.getCenter();\r\n            document.getElementById(id).value = JSON.stringify({\r\n                type: 'Point',\r\n                coordinates: [c.lng, c.lat]\r\n            });\r\n        }).fire('moveend');\r\n    },\r\n\r\n    newMarker: function(latlng, options) {      // create a new marker of any type\r\n        let type = options.type || 'Marker';\r\n        if (type === 'Marker' && options.icon)  {\r\n            options.icon = L.icon(options.icon);\r\n        }\r\n        let r = new L[type](latlng, options).on('moveend', function(e) {\r\n            let id = e.target.options.monitor;\r\n            if (id) {\r\n                document.getElementById(id).value = JSON.stringify(e.target.toGeoJSON());\r\n            }\r\n        }).on('click', function (e)    {\r\n            let url = this.options.urlTemplate;\r\n            if (url)  {\r\n                let matches = url.match(/{\\w+}/g);\r\n                if (matches)    {\r\n                    matches.forEach(function(match) {\r\n                        url = url.replace(match, e.target.options[match.slice(1, -1)]);\r\n                    }, this);\r\n                }\r\n                if (this.options.popup !== null)   {\r\n                    let pOpts = this.options.popup,\r\n                        popup = L.popup(pOpts).setLatLng(e.latlng).setContent(pOpts.loading).openOn(this);\r\n\r\n                    let request = new XMLHttpRequest();\r\n                    request.open('GET', url, true);\r\n\r\n                    request.onload = function() {\r\n                        if (this.status >= 200 && this.status < 400) {\r\n                            popup.setContent(this.response);\r\n                        }\r\n                    };\r\n                    request.send();\r\n                }\r\n                else    {\r\n                    window.location = url;\r\n                }\r\n            }\r\n        }, this);   // context = map\r\n\r\n        if (options.title)  {\r\n            r.bindTooltip(options.title);\r\n        }\r\n        return r;\r\n    },\r\n\r\n    addMarker: function(latlng, markerOpts)  {\r\n        let m = this.newMarker(latlng, markerOpts);\r\n        this.addLayer(m);\r\n        this._marker = m;\r\n        m.fire('moveend');\r\n        return this;\r\n    },\r\n\r\n    placeMarker: function(latlng)   {\r\n        if (this._marker)    {\r\n            this._marker.setLatLng(latlng);\r\n        }\r\n        else {\r\n            this.unarm().addMarker(latlng, this.options.marker);\r\n        }\r\n        this.panTo(latlng);\r\n    },\r\n});\r\n"],"names":["L","TouchDragHandler","Handler","extend","addHooks","this","_map","dragging","disable","tap","_container","addEventListener","_handleTouch","DomEvent","on","removeHooks","enable","removeEventListener","off","e","type","touches","length","DomUtil","addClass","target","removeClass","DotMarker","CircleMarker","initialize","latlng","options","let","cl","className","prototype","call","Object","assign","radius","weight","fillOpacity","dotMarker","SpriteMarker","Marker","icon","divIcon","html","iconSize","bgPos","spriteMarker","Map","include","find","address","const","map","req1","XMLHttpRequest","resp","JSON","parse","response","found","latLng","lat","lon","placeMarker","fire","open","server","encodeURIComponent","send","addInitHook","scale","s","metric","imperial","addControl","control","touchdrag","addHandler","_markers","_armed","getMarkers","cluster","markerClusterGroup","addLayer","arm","markerOpts","getContainer","marker","disarm","addMarker","addFeature","feature","geoJSON","pointToLayer","ft","newMarker","properties","bind","monitorZoom","id","document","getElementById","value","getZoom","monitorCenter","c","getCenter","stringify","coordinates","lng","r","monitor","toGeoJSON","url","urlTemplate","matches","match","forEach","replace","slice","popup","pOpts","setLatLng","setContent","loading","openOn","request","onload","status","window","location","title","bindTooltip","m","_marker","unarm","panTo"],"mappings":"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"}
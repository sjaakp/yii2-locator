{"version":3,"file":"locator.js","sources":["../src/touchdrag.js","../src/dotmarker.js","../src/spritemarker.js","../src/index.js"],"sourcesContent":["/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n// https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\r\n// https://github.com/elmarquis/Leaflet.GestureHandling\r\n\r\nL.TouchDragHandler = L.Handler.extend({\r\n    addHooks() {\r\n        this._map.dragging.disable();\r\n        if (this._map.tap) {\r\n            this._map.tap.disable();\r\n        }\r\n        this._map._container.addEventListener('touchstart', this._handleTouch);\r\n        this._map._container.addEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.on(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    removeHooks() {\r\n        this._map.dragging.enable();\r\n        if (this._map.tap) {\r\n            this._map.tap.enable();\r\n        }\r\n        this._map._container.removeEventListener('touchstart', this._handleTouch);\r\n        this._map._container.removeEventListener('touchend', this._handleTouch);\r\n        L.DomEvent.off(this._map._container, 'click', this._handleTouch, this);\r\n    },\r\n\r\n    _handleTouch(e) {\r\n        if (e.type === 'touchstart' && e.touches.length === 1)  {\r\n            L.DomUtil.addClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.disable();\r\n        } else {\r\n            L.DomUtil.removeClass(e.target, 'leaflet-touchdrag');\r\n            this._map.dragging.enable();\r\n        }\r\n        return true;\r\n    },\r\n});\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.DotMarker = L.CircleMarker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the DotMarker:\r\n     * - 'className': HTML class of underlying SVG <path>. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#path\r\n     */\r\n    initialize(latlng, options = {}) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        L.CircleMarker.prototype.initialize.call(this, latlng, Object.assign(options, {\r\n            radius: 8,\r\n            weight: 2,\r\n            fillOpacity: 1.0,\r\n            className: cl + 'dot-marker'\r\n        }));\r\n    }\r\n});\r\n\r\nL.dotMarker = function(latlng, options = {}) {\r\n    return new L.DotMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2019\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\nL.SpriteMarker = L.Marker.extend({\r\n\r\n    /**\r\n     * @param latlng\r\n     * @param options options for the SpriteMarker:\r\n     * - 'html': content of SpriteMarker; default empty. @link https://leafletjs.com/reference-1.6.0.html#divicon\r\n     * - 'className': HTML class of DIV. Notice: *not* 'class'. @link https://leafletjs.com/reference-1.6.0.html#divicon-classname\r\n     * Use this to display FontAwesome markers like so: 'className': 'far fa-2x fa-dog'; leave 'html' unset.\r\n     */\r\n    initialize(latlng, options = {}) {\r\n        let cl = options.className ? options.className + ' ' : '';\r\n        options.icon = L.divIcon({\r\n            html: options.html || false,\r\n            iconSize: options.iconSize || 24,\r\n            bgPos: options.bgPos || null,\r\n            className: cl + 'sprite-marker'\r\n        });\r\n        L.Marker.prototype.initialize.call(this, latlng, options);\r\n    },\r\n});\r\n\r\nL.spriteMarker = function(latlng, options = {}) {\r\n    return new L.SpriteMarker(latlng, options);\r\n};\r\n","/**\r\n * sjaakp/yii2-locator\r\n * ----------\r\n * Leaflet wrapper for Yii2 framework\r\n * Version 1.0.0\r\n * Copyright (c) 2020\r\n * Sjaak Priester, Amsterdam\r\n * MIT License\r\n * https://github.com/sjaakp/yii2-locator\r\n * https://sjaakpriester.nl\r\n */\r\n\r\n/*\r\n    Plugin for Leaflet\r\n    Tested with Leaflet 1.6.0\r\n    21-05-2018 ... 14-01-2020\r\n\r\n    Map has extra options:\r\n        marker      Plain object, options used for creating markers\r\n                        the option 'type' determines the type of marker (Marker, CircleMarker, DotMarker, SpriteMarker)\r\n                        the option 'icon' is a plain object with options to create the icon for a regular Marker (i.e. not the icon itself)\r\n        urlTemplate     String, url jumped to or used to get popup contents when marker is clicked. If not set, no jump is performed.\r\n                        '{xxx}' gets replaced by Marker option <xxx>\r\n                        typical use: urlTemplate = '/view/{id}'\r\n        cluster     null|object. MarkerClusterer options; null: no clusters.\r\n        popup       null|object. Popup options; null: no popups.\r\n        touchdrag   Boolean. If true, map can only be panned with two fingers; warning overlay appears if attempted with one finger.\r\n                        Intended to avoid conflict with page scrolling on small devices.\r\n        scale       null: no scale | 1: metric scale | 2: imperial scale | 3: both.\r\n\r\n    Two new classes:\r\n\r\n    DotMarker is an extension of CircleMarker. It gets the HTML class 'dot-marker'.\r\n\r\n    SpriteMarker is a Marker with a DivIcon. It has all the options of DivIcon. It gets the HTML class 'sprite-marker'.\r\n        Typical use: set the 'html' option to a SVG-element, either with an explicit path or a use class; use the option 'className' to colorize the sprite\r\n\r\n    Marker, CircleMarker, DotMarker, SpriteMarker each have extra options\r\n        monitor     String, the id of a HTML text input updated at moveend\r\n        title       HTML of tooltip\r\n\r\n    @link https://leafletjs.com/\r\n    @link http://www.liedman.net/tiled-maps/ - The Hitchhackerâ€™s Guide To Tiled Maps\r\n */\r\n\r\nimport './locator.scss';\r\nimport './touchdrag.js';\r\nimport './dotmarker.js';\r\nimport './spritemarker.js';\r\n\r\nL.Map.addInitHook(function() {\r\n    if (this.options.scale !== null) {\r\n        const s = this.options.scale,\r\n            metric = s & 1,\r\n            imperial = s & 2;\r\n        this.addControl(L.control.scale({ metric: metric, imperial: imperial }));    // add scale control\r\n    }\r\n    if (this.options.touchdrag) this.addHandler('touchdrag', L.TouchDragHandler);       // and touchdrag handler\r\n    this.on('geofound', e => { this.disarm(); }, this);\r\n});\r\n\r\n\r\nL.Map.include({\r\n\r\n    _markers: null,\r\n    _armed: false,      // true if click on map produces a marker\r\n\r\n    getMarkers()  {\r\n        if (! this._markers)    {\r\n            if (this.options.cluster !== null)  {\r\n                this._markers = L.markerClusterGroup(this.options.cluster);\r\n                this.addLayer(this._markers);\r\n            }\r\n            else this._markers = this;\r\n        }\r\n        return this._markers;\r\n    },\r\n\r\n    arm(markerOpts) {       // prepare for marker on click\r\n        if (! this._armed)  {\r\n            L.DomUtil.addClass(this.getContainer(), 'locator-armed');\r\n            this.options.marker = markerOpts;\r\n            this.on('click', function(e) {\r\n                this.disarm();\r\n                return this.addMarker(e.latlng, markerOpts);\r\n            });\r\n            this._armed = true;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    disarm() {\r\n        if (this._armed)    {\r\n            L.DomUtil.removeClass(this.getContainer(), 'locator-armed');\r\n            this.off('click');\r\n            this._armed = false;\r\n        }\r\n        return this;\r\n    },\r\n\r\n    addFeature(feature)   {\r\n        this.getMarkers().addLayer(L.geoJSON(feature, {\r\n            pointToLayer: function(ft, latlng) {\r\n                return this.newMarker(latlng, Object.assign({}, this.options.marker, ft.properties));\r\n            }.bind(this),\r\n        }));\r\n        return this;\r\n    },\r\n\r\n    monitorZoom(id) {\r\n        return this.on('zoomend', function(e) {\r\n            document.getElementById(id).value = e.target.getZoom();\r\n        }).fire('zoomend');\r\n    },\r\n\r\n    monitorCenter(id) {\r\n        return this.on('moveend', function(e) {\r\n            const c = e.target.getCenter();\r\n            document.getElementById(id).value = JSON.stringify({\r\n                type: 'Point',\r\n                coordinates: [c.lng, c.lat]\r\n            });\r\n        }).fire('moveend');\r\n    },\r\n\r\n    /**\r\n     * Create a new marker of any type\r\n     * @param latlng\r\n     * @param options if null, use this.options.marker\r\n     * @returns {*}\r\n     */\r\n    newMarker(latlng, options = null) {\r\n        if (options == null) options = this.options.marker;\r\n        const type = options.type || 'Marker';\r\n        if (type === 'Marker' && options.icon)  {\r\n            options.icon = L.icon(options.icon);\r\n        }\r\n        let r = new L[type](latlng, options).on('moveend', function(e) {\r\n            const id = e.target.options.monitor;\r\n            if (id) {\r\n                document.getElementById(id).value = JSON.stringify(e.target.toGeoJSON());\r\n            }\r\n        }).on('click', function (e)    {\r\n            let url = this.options.urlTemplate;\r\n            if (url)  {\r\n                let matches = url.match(/{\\w+}/g);\r\n                if (matches)    {\r\n                    matches.forEach(function(match) {\r\n                        url = url.replace(match, e.target.options[match.slice(1, -1)]);\r\n                    }, this);\r\n                }\r\n                if (this.options.popup !== null)   {\r\n                    const pOpts = this.options.popup,\r\n                        popup = L.popup(pOpts).setLatLng(e.latlng).setContent('<svg class=\"locator-loading\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z\"/></svg>')\r\n                            .openOn(this);\r\n\r\n                    fetch(url)\r\n                        .then(response => response.text())\r\n                        .then(html => popup.setContent(html));\r\n                }\r\n                else    {\r\n                    window.location = url;\r\n                }\r\n            }\r\n        }, this);   // context = map\r\n\r\n        if (options.title)  {\r\n            r.bindTooltip(options.title);\r\n        }\r\n        return r;\r\n    },\r\n\r\n    addMarker(latlng, markerOpts)  {\r\n        const m = this.newMarker(latlng, markerOpts);\r\n        this.addLayer(m);\r\n        this.marker = m;\r\n        m.fire('moveend');\r\n        return this;\r\n    }\r\n});\r\n"],"names":["L","TouchDragHandler","Handler","extend","addHooks","this","_map","dragging","disable","tap","_container","addEventListener","_handleTouch","DomEvent","on","removeHooks","enable","removeEventListener","off","e","type","touches","length","DomUtil","addClass","target","removeClass","DotMarker","CircleMarker","initialize","latlng","options","let","cl","className","prototype","call","Object","assign","radius","weight","fillOpacity","dotMarker","SpriteMarker","Marker","icon","divIcon","html","iconSize","bgPos","spriteMarker","Map","addInitHook","scale","const","s","metric","imperial","addControl","control","touchdrag","addHandler","disarm","include","_markers","_armed","getMarkers","cluster","markerClusterGroup","addLayer","arm","markerOpts","getContainer","marker","addMarker","addFeature","feature","geoJSON","pointToLayer","ft","newMarker","properties","bind","monitorZoom","id","document","getElementById","value","getZoom","fire","monitorCenter","c","getCenter","JSON","stringify","coordinates","lng","lat","r","monitor","toGeoJSON","url","urlTemplate","matches","match","forEach","replace","slice","popup","pOpts","setLatLng","setContent","openOn","fetch","then","response","text","window","location","title","bindTooltip","m"],"mappings":"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"}
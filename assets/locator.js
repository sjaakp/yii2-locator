/*!
 * Locator 1.0.0
 * (c) 2020 Sjaak Priester, Amsterdam
 * MIT License
 * https://github.com/sjaakp/yii2-locator
 * https://sjaakpriester.nl
 */
!function(){"use strict";L.TouchDragHandler=L.Handler.extend({addHooks:function(){this._map.dragging.disable(),this._map.tap&&this._map.tap.disable(),this._map._container.addEventListener("touchstart",this._handleTouch),this._map._container.addEventListener("touchend",this._handleTouch),L.DomEvent.on(this._map._container,"click",this._handleTouch,this)},removeHooks:function(){this._map.dragging.enable(),this._map.tap&&this._map.tap.enable(),this._map._container.removeEventListener("touchstart",this._handleTouch),this._map._container.removeEventListener("touchend",this._handleTouch),L.DomEvent.off(this._map._container,"click",this._handleTouch,this)},_handleTouch:function(t){return"touchstart"===t.type&&1===t.touches.length?(L.DomUtil.addClass(t.target,"leaflet-touchdrag"),this._map.dragging.disable()):(L.DomUtil.removeClass(t.target,"leaflet-touchdrag"),this._map.dragging.enable()),!0}}),L.DotMarker=L.CircleMarker.extend({initialize:function(t,e){var i=e.className?e.className+" ":"";L.CircleMarker.prototype.initialize.call(this,t,Object.assign(e,{radius:8,weight:2,fillOpacity:1,className:i+"dot-marker"}))}}),L.dotMarker=function(t,e){return new L.DotMarker(t,e)},L.SpriteMarker=L.Marker.extend({initialize:function(t,e){var i=e.className?e.className+" ":"";e.icon=L.divIcon({html:e.html||!1,iconSize:e.iconSize||24,bgPos:e.bgPos||null,className:i+"sprite-marker"}),L.Marker.prototype.initialize.call(this,t,e)}}),L.spriteMarker=function(t,e){return new L.SpriteMarker(t,e)},L.Map.include({find:function(t){var e=this,i=new XMLHttpRequest;return i.addEventListener("load",(function(){var t=JSON.parse(this.response);if(t.length>0){var i=t[0],n=L.latLng(i.lat,i.lon);e.placeMarker(n)}else e.fire("notfound")})),i.open("GET","//nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(t)),i.send(),this}}),L.Map.addInitHook((function(){if(null!==this.options.scale){var t=this.options.scale,e=1&t,i=2&t;this.addControl(L.control.scale({metric:e,imperial:i}))}this.options.touchdrag&&this.addHandler("touchdrag",L.TouchDragHandler)})),L.Map.include({_geo:null,_armed:!1,arm:function(t){return this._armed||(L.DomUtil.addClass(this.getContainer(),"locator-armed"),this.options.marker=t,this.on("click",(function(e){return this.disarm(),this.addMarker(e.latlng,t)})),this._armed=!0),this},disarm:function(){return this._armed&&(L.DomUtil.removeClass(this.getContainer(),"locator-armed"),this.off("click"),this._armed=!1),this},getGeo:function(){if(!this._geo){var t=L.geoJSON(null,{pointToLayer:function(t,e){var i=this.newMarker(e,Object.assign({},this.options.marker,t.properties)),n=t.properties.title;return n&&i.bindTooltip(n),i}.bind(this)}),e=t;this.options.cluster&&(e=L.markerClusterGroup()).addLayer(t),this.addLayer(e),this._geo=t}return this._geo},addFeature:function(t){return this.getGeo().addData(t),this},monitorZoom:function(t){return this.on("zoomend",(function(e){document.getElementById(t).value=e.target.getZoom()})).fire("zoomend")},monitorCenter:function(t){return this.on("moveend",(function(e){var i=e.target.getCenter();document.getElementById(t).value=JSON.stringify({type:"Point",coordinates:[i.lng,i.lat]})})).fire("moveend")},newMarker:function(t,e){var i=e.type||"Marker";"Marker"===i&&e.icon&&(e.icon=L.icon(e.icon));var n=new L[i](t,e).on("moveend",(function(t){var e=t.target.options.monitor;e&&(document.getElementById(e).value=JSON.stringify(t.target.toGeoJSON()))})).on("click",(function(t){var e=this._map.options.viewUrl;if(e){var i=e.match(/{\w+}/g);i&&i.forEach((function(t){e=e.replace(t,this.options[t.slice(1,-1)])}),this),window.location=e}}));return e.title&&n.bindTooltip(e.title),n},addMarker:function(t,e){var i=this.newMarker(t,e);return this.addLayer(i),this._marker=i,i.fire("moveend"),this},placeMarker:function(t){this._marker?this._marker.setLatLng(t):this.unarm().addMarker(t,this.options.marker),this.panTo(t)}})}();
//# sourceMappingURL=locator.js.map

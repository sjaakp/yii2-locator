/*!
 * Locator 1.0.0
 * (c) 2020 Sjaak Priester, Amsterdam
 * MIT License
 * https://github.com/sjaakp/yii2-locator
 * https://sjaakpriester.nl
 */
!function(){"use strict";L.TouchDragHandler=L.Handler.extend({addHooks:function(){this._map.dragging.disable(),this._map.tap&&this._map.tap.disable(),this._map._container.addEventListener("touchstart",this._handleTouch),this._map._container.addEventListener("touchend",this._handleTouch),L.DomEvent.on(this._map._container,"click",this._handleTouch,this)},removeHooks:function(){this._map.dragging.enable(),this._map.tap&&this._map.tap.enable(),this._map._container.removeEventListener("touchstart",this._handleTouch),this._map._container.removeEventListener("touchend",this._handleTouch),L.DomEvent.off(this._map._container,"click",this._handleTouch,this)},_handleTouch:function(t){return"touchstart"===t.type&&1===t.touches.length?(L.DomUtil.addClass(t.target,"leaflet-touchdrag"),this._map.dragging.disable()):(L.DomUtil.removeClass(t.target,"leaflet-touchdrag"),this._map.dragging.enable()),!0}}),L.DotMarker=L.CircleMarker.extend({initialize:function(t,e){var n=e.className?e.className+" ":"";L.CircleMarker.prototype.initialize.call(this,t,Object.assign(e,{radius:8,weight:2,fillOpacity:1,className:n+"dot-marker"}))}}),L.dotMarker=function(t,e){return new L.DotMarker(t,e)},L.SpriteMarker=L.Marker.extend({initialize:function(t,e){var n=e.className?e.className+" ":"";e.icon=L.divIcon({html:e.html||!1,iconSize:e.iconSize||24,bgPos:e.bgPos||null,className:n+"sprite-marker"}),L.Marker.prototype.initialize.call(this,t,e)}}),L.spriteMarker=function(t,e){return new L.SpriteMarker(t,e)},L.Map.include({find:function(t){var e=this,n=new XMLHttpRequest;return n.addEventListener("load",(function(){var t=JSON.parse(this.response);if(t.length>0){var n=t[0],i=L.latLng(n.lat,n.lon);e.placeMarker(i)}else e.fire("notfound")})),n.open("GET","//nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(t)),n.send(),this}}),L.Map.addInitHook((function(){if(null!==this.options.scale){var t=this.options.scale,e=1&t,n=2&t;this.addControl(L.control.scale({metric:e,imperial:n}))}this.options.touchdrag&&this.addHandler("touchdrag",L.TouchDragHandler)})),L.Map.include({_markers:null,_armed:!1,getMarkers:function(){return this._markers||(null!==this.options.cluster?(this._markers=L.markerClusterGroup(this.options.cluster),this.addLayer(this._markers)):this._markers=this),this._markers},arm:function(t){return this._armed||(L.DomUtil.addClass(this.getContainer(),"locator-armed"),this.options.marker=t,this.on("click",(function(e){return this.disarm(),this.addMarker(e.latlng,t)})),this._armed=!0),this},disarm:function(){return this._armed&&(L.DomUtil.removeClass(this.getContainer(),"locator-armed"),this.off("click"),this._armed=!1),this},addFeature:function(t){return this.getMarkers().addLayer(L.geoJSON(t,{pointToLayer:function(t,e){return this.newMarker(e,Object.assign({},this.options.marker,t.properties))}.bind(this)})),this},monitorZoom:function(t){return this.on("zoomend",(function(e){document.getElementById(t).value=e.target.getZoom()})).fire("zoomend")},monitorCenter:function(t){return this.on("moveend",(function(e){var n=e.target.getCenter();document.getElementById(t).value=JSON.stringify({type:"Point",coordinates:[n.lng,n.lat]})})).fire("moveend")},newMarker:function(t,e){var n=e.type||"Marker";"Marker"===n&&e.icon&&(e.icon=L.icon(e.icon));var i=new L[n](t,e).on("moveend",(function(t){var e=t.target.options.monitor;e&&(document.getElementById(e).value=JSON.stringify(t.target.toGeoJSON()))})).on("click",(function(t){var e=this.options.urlTemplate;if(e){var n=e.match(/{\w+}/g);if(n&&n.forEach((function(n){e=e.replace(n,t.target.options[n.slice(1,-1)])}),this),null!==this.options.popup){var i=this.options.popup,r=L.popup(i).setLatLng(t.latlng).setContent(i.loading).openOn(this),a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(){this.status>=200&&this.status<400&&r.setContent(this.response)},a.send()}else window.location=e}}),this);return e.title&&i.bindTooltip(e.title),i},addMarker:function(t,e){var n=this.newMarker(t,e);return this.addLayer(n),this._marker=n,n.fire("moveend"),this},placeMarker:function(t){this._marker?this._marker.setLatLng(t):this.unarm().addMarker(t,this.options.marker),this.panTo(t)}})}();
//# sourceMappingURL=locator.js.map

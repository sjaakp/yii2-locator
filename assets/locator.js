/*!
 * Locator 1.0.0
 * (c) 2020 Sjaak Priester, Amsterdam
 * MIT License
 * https://github.com/sjaakp/yii2-locator
 * https://sjaakpriester.nl
 */
!function(){"use strict";!function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}}(".sprite-marker{display:flex;align-items:center;justify-content:center;color:var(--fa-secondary-color)}.locator-search{border-radius:4px;box-shadow:0 1px 5px rgba(0,0,0,.65)}.locator-search svg{width:1em}.locator-search input{transition:width .4s;width:0;padding:1px 0;border:solid #888;border-width:1px 0;outline:0}.locator-search.open input{width:15em;padding:1px 2px;border-width:1px}.locator-search button{border:1px solid #888}.locator-search button:hover{background-color:#ddd}"),L.TouchDragHandler=L.Handler.extend({addHooks:function(){this._map.dragging.disable(),this._map.tap&&this._map.tap.disable(),this._map._container.addEventListener("touchstart",this._handleTouch),this._map._container.addEventListener("touchend",this._handleTouch),L.DomEvent.on(this._map._container,"click",this._handleTouch,this)},removeHooks:function(){this._map.dragging.enable(),this._map.tap&&this._map.tap.enable(),this._map._container.removeEventListener("touchstart",this._handleTouch),this._map._container.removeEventListener("touchend",this._handleTouch),L.DomEvent.off(this._map._container,"click",this._handleTouch,this)},_handleTouch:function(t){return"touchstart"===t.type&&1===t.touches.length?(L.DomUtil.addClass(t.target,"leaflet-touchdrag"),this._map.dragging.disable()):(L.DomUtil.removeClass(t.target,"leaflet-touchdrag"),this._map.dragging.enable()),!0}}),L.DotMarker=L.CircleMarker.extend({initialize:function(t,e){var n=e.className?e.className+" ":"";L.CircleMarker.prototype.initialize.call(this,t,Object.assign(e,{radius:8,weight:2,fillOpacity:1,className:n+"dot-marker"}))}}),L.dotMarker=function(t,e){return new L.DotMarker(t,e)},L.SpriteMarker=L.Marker.extend({initialize:function(t,e){var n=e.className?e.className+" ":"";e.icon=L.divIcon({html:e.html||!1,iconSize:e.iconSize||24,bgPos:e.bgPos||null,className:n+"sprite-marker"}),L.Marker.prototype.initialize.call(this,t,e)}}),L.spriteMarker=function(t,e){return new L.SpriteMarker(t,e)},L.geo={Geocoder:L.Class.extend({initialize:function(t,e){this._map=t,L.setOptions(this,e)},constructUrl:function(t,e){void 0===e&&(e={});var n=Object.assign({},this.options,e),o=new URL(t);for(var i in n)o.searchParams.set(i,n[i]);return o},fetchJson:function(t){return fetch(t.href).then((function(t){return t.json()}))},placeMarker:function(t,e){this._map.placeMarker(t,e)},fire:function(t){this._map.fire(t)},suggest:function(t,e){},lookup:function(t){}})},L.geo.Nominatim=L.geo.Geocoder.extend({url:"https://nominatim.openstreetmap.org/",mark:function(t){var e=L.latLng(t.lat,t.lon),n=t.boundingbox,o=L.latLngBounds([n[0],n[2]],[n[1],n[3]]);this.placeMarker(e,o)},search:function(t){var e=this.constructUrl(this.url+"search",{format:"json",q:t});return this.fetchJson(e)},suggest:function(t,e){var n=this;this.search(t).then((function(t){e.innerHTML=t.reduce((function(t,e){return t+'<option data-id="'+e.osm_type.charAt(0).toUpperCase()+e.osm_id+'">'+e.display_name+"</option>"}),"")})).catch((function(t){return n.fire(t)}))},lookup:function(t){var e=this,n=this.constructUrl(this.url+"reverse",{format:"json",osm_type:t.charAt(0),osm_id:t.slice(1)});this.fetchJson(n).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))},geocode:function(t){var e=this;this.search(t).then((function(t){if(t.length<1)throw"notfound";return t[0]})).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))}}),L.geo.Here=L.geo.Geocoder.extend({mark:function(t){var e=t.displayPosition,n=L.latLng(e.latitude,e.longitude),o=t.mapView,i=o.topLeft,r=o.bottomRight,s=L.latLngBounds([i.latitude,r.longitude],[r.latitude,i.longitude]);this.placeMarker(n,s)},fetchData:function(t){var e=this;t.jsonattributes=1;var n=this.constructUrl("https://geocoder.ls.hereapi.com/6.2/geocode.json",t);this.fetchJson(n).then((function(t){return t.response.view.shift().result.shift()})).then((function(t){return e.mark(t.location)})).catch((function(t){return e.fire(t)}))},suggest:function(t,e){var n=this,o=this.constructUrl("https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json",{query:t});this.fetchJson(o).then((function(t){return t.suggestions})).then((function(t){e.innerHTML=t.reduce((function(t,e){return t+'<option data-id="'+e.locationId+'">'+e.label+"</option>"}),"")})).catch((function(t){return n.fire(t)}))},lookup:function(t){this.fetchData({locationid:t})},geocode:function(t){this.fetchData({searchtext:t})}}),L.geo.GeoNames=L.geo.Geocoder.extend({url:"http://api.geonames.org/search",fetchGeonames:function(t){return this.fetchJson(t).then((function(t){var e=t.geonames;if(!e||e.length<1)throw"notfound";return e}))},mark:function(t){var e=L.latLng(t.lat,t.lng),n=t.bbox,o=L.latLngBounds([n.north,n.west],[n.south,n.east]);this.placeMarker(e,o)},suggest:function(t,e){var n=this,o=this.constructUrl(this.url,{q:t,type:"json",style:"short"});this.fetchGeonames(o).then((function(t){e.innerHTML=t.reduce((function(t,e){return t+'<option data-id="'+e.geonameId+'">'+e.name+"&emsp;"+e.countryCode+"</option>"}),"")})).catch((function(t){return n.fire(t)}))},lookup:function(t){var e=this,n=this.constructUrl("http://api.geonames.org/getJSON",{geonameId:t});this.fetchJson(n).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))},geocode:function(t){var e=this,n=this.constructUrl(this.url,{q:t,inclBbox:!0});this.fetchGeonames(n).then((function(t){return t.shift()})).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))}}),L.geo.TomTom=L.geo.Geocoder.extend({url:"https://api.tomtom.com/search/2/geocode/",suggestions:[],datalist:null,mark:function(t){var e=t.position,n=L.latLng(e.lat,e.lon),o=t.viewport,i=o.topLeftPoint,r=o.btmRightPoint,s=L.latLngBounds([i.lat,r.lon],[r.lat,i.lon]);this.placeMarker(n,s)},fetchResults:function(t,e){void 0===e&&(e={});var n=encodeURIComponent(t),o=this.constructUrl(""+this.url+n+".json",e);return this.fetchJson(o).then((function(t){if(t.summary.numResults<1)throw"notfound";return t.results}))},suggest:function(t,e){var n=this;this.datalist=e,this.fetchResults(t,{typeahead:!0}).then((function(t){n.suggestions=t,e.innerHTML=t.reduce((function(t,e){return t+'<option data-id="'+e.id+'">'+e.address.freeformAddress+"</option>"}),"")})).catch((function(t){return n.fire(t)}))},lookup:function(t){var e=this.suggestions.find((function(e){return e.id===t}));e&&this.mark(e)},geocode:function(t){var e=this;this.fetchResults(t).then((function(t){return t.shift()})).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))}}),L.geo.Kadaster=L.geo.Geocoder.extend({url:"https://geodata.nationaalgeoregister.nl/locatieserver/v3/",mark:function(t){this.placeMarker(t.centroide_ll.match(/[\d.]+/g).reverse())},suggest:function(t,e){var n=this,o=this.constructUrl(this.url+"suggest",{q:t+" and -type:postcode"});this.fetchJson(o).then((function(t){if(t.response.numFound<1)throw"notfound";return t.highlighting})).then((function(t){var n="";for(var o in t){n+='<option data-id="'+o+'">'+t[o].suggest.shift()+"</option>"}e.innerHTML=n})).catch((function(t){return n.fire(t)}))},lookup:function(t){var e=this,n=this.constructUrl(this.url+"lookup",{id:t});this.fetchJson(n).then((function(t){return t.response.docs.shift()})).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))},geocode:function(t){var e=this,n=this.constructUrl(this.url+"free",{q:t+" and -type:postcode"});this.fetchJson(n).then((function(t){if(t.response.numFound<1)throw"notfound";return t.response.docs.shift()})).then((function(t){return e.mark(t)})).catch((function(t){return e.fire(t)}))}}),L.Search=L.Control.extend({initialize:function(t){L.setOptions(this,t||{})},onAdd:function(t){var e=t.getContainer().id+"_dl",n=L.DomUtil.create("div","locator-search"),o=L.DomUtil.create("input",null,n);o.type="text",o.setAttribute("list",e),L.DomEvent.on(o,"input",(function(t){t.target.value.length>=2&&this._geocoder.suggest(t.target.value,r)}),t),L.DomEvent.on(o,"change",(function(t){var e=t.target.value,o=r.childNodes;t.target.value="",n.classList.remove("open");for(var i=0;i<o.length;i++)if(e.startsWith(o[i].innerText))return void this._geocoder.lookup(o[i].dataset.id);this.find(e)}),t);var i=L.DomUtil.create("button",null,n);i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>',i.title="Search",L.DomEvent.on(i,"click",(function(t){t.preventDefault(),this.toggle()}),this);var r=L.DomUtil.create("datalist",null,n);return r.id=e,n},toggle:function(){var t=this.getContainer(),e=t.classList,n=e.contains("open");e.toggle("open"),n||t.children[0].focus()}}),L.search=function(t){return new L.Search(t)},L.Map.include({find:function(t){return this._geocoder.geocode(t),this},geocoder:function(t,e){return this._geocoder=new L.geo[t](this,e),this},finder:function(t){this.addControl(L.search(t))}}),L.Map.addInitHook((function(){this.geocoder("Nominatim",{})})),L.Map.addInitHook((function(){if(null!==this.options.scale){var t=this.options.scale,e=1&t,n=2&t;this.addControl(L.control.scale({metric:e,imperial:n}))}this.options.touchdrag&&this.addHandler("touchdrag",L.TouchDragHandler)})),L.Map.include({_markers:null,_armed:!1,getMarkers:function(){return this._markers||(null!==this.options.cluster?(this._markers=L.markerClusterGroup(this.options.cluster),this.addLayer(this._markers)):this._markers=this),this._markers},arm:function(t){return this._armed||(L.DomUtil.addClass(this.getContainer(),"locator-armed"),this.options.marker=t,this.on("click",(function(e){return this.disarm(),this.addMarker(e.latlng,t)})),this._armed=!0),this},disarm:function(){return this._armed&&(L.DomUtil.removeClass(this.getContainer(),"locator-armed"),this.off("click"),this._armed=!1),this},addFeature:function(t){return this.getMarkers().addLayer(L.geoJSON(t,{pointToLayer:function(t,e){return this.newMarker(e,Object.assign({},this.options.marker,t.properties))}.bind(this)})),this},monitorZoom:function(t){return this.on("zoomend",(function(e){document.getElementById(t).value=e.target.getZoom()})).fire("zoomend")},monitorCenter:function(t){return this.on("moveend",(function(e){var n=e.target.getCenter();document.getElementById(t).value=JSON.stringify({type:"Point",coordinates:[n.lng,n.lat]})})).fire("moveend")},newMarker:function(t,e){var n=e.type||"Marker";"Marker"===n&&e.icon&&(e.icon=L.icon(e.icon));var o=new L[n](t,e).on("moveend",(function(t){var e=t.target.options.monitor;e&&(document.getElementById(e).value=JSON.stringify(t.target.toGeoJSON()))})).on("click",(function(t){var e=this.options.urlTemplate;if(e){var n=e.match(/{\w+}/g);if(n&&n.forEach((function(n){e=e.replace(n,t.target.options[n.slice(1,-1)])}),this),null!==this.options.popup){var o=this.options.popup,i=L.popup(o).setLatLng(t.latlng).setContent(o.loading).openOn(this);fetch(e).then((function(t){return t.text()})).then((function(t){return i.setContent(t)}))}else window.location=e}}),this);return e.title&&o.bindTooltip(e.title),o},addMarker:function(t,e){var n=this.newMarker(t,e);return this.addLayer(n),this._marker=n,n.fire("moveend"),this},placeMarker:function(t,e){this._marker?this._marker.setLatLng(t):this.disarm().addMarker(t,this.options.marker),this.options.fly?e?this.flyToBounds(e):this.flyTo(t):e?this.fitBounds(e):this.panTo(t)}})}();
//# sourceMappingURL=locator.js.map
